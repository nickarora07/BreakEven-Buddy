# India D2C Profitability Calculator (Custom GPT Logic)

def calculate_d2c_profit(
    aov,
    orders_received,
    delivery_rate,
    product_cost,
    shipping_cost,
    rto_cost,
    cpa,
    output_gst_rate,
    input_gst_product_rate
):
    # Core Calculations
    delivered_orders = int(orders_received * (delivery_rate / 100))
    rto_orders = orders_received - delivered_orders

    gross_revenue = delivered_orders * aov
    output_gst = gross_revenue * (output_gst_rate / 100)
    net_revenue = gross_revenue - output_gst

    total_product_cost = delivered_orders * product_cost
    total_shipping_cost = delivered_orders * shipping_cost
    total_rto_cost = rto_orders * rto_cost
    total_cpa = orders_received * cpa

    # Updated Input GST Credit logic
    input_gst_credit = (
        total_product_cost * (input_gst_product_rate / 100) +
        total_shipping_cost * 0.18 +
        total_cpa * 0.18
    )

    gst_payable = output_gst - input_gst_credit

    total_expense = total_product_cost + total_shipping_cost + total_rto_cost + total_cpa + gst_payable
    net_profit = net_revenue - total_expense

    profit_per_delivered_order = net_profit / delivered_orders if delivered_orders > 0 else 0

    return {
        "Delivered Orders": delivered_orders,
        "RTO Orders": rto_orders,
        "Gross Revenue (incl GST)": gross_revenue,
        "Output GST": output_gst,
        "Net Revenue (excl GST)": net_revenue,
        "Total Product Cost": total_product_cost,
        "Total Shipping Cost": total_shipping_cost,
        "Total RTO Cost": total_rto_cost,
        "Total CPA": total_cpa,
        "Input GST Credit": input_gst_credit,
        "GST Payable": gst_payable,
        "Total Expenses": total_expense,
        "Net Profit": net_profit,
        "Profit per Delivered Order": profit_per_delivered_order
    }

# Example test run
example = calculate_d2c_profit(
    aov=450,
    orders_received=100,
    delivery_rate=70,
    product_cost=56,
    shipping_cost=100,
    rto_cost=40,
    cpa=100,
    output_gst_rate=12,
    input_gst_product_rate=18
)

for key, value in example.items():
    print(f"{key}: â‚¹{value:,.2f}" if isinstance(value, (int, float)) else f"{key}: {value}")
